<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SentimentAnalyserX | Dashboard</title>
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css'>
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='userpage.css') }}">
    <style>
        /* ... (previous styles) ... */

        .pagination {
            margin-top: 20px;
            text-align: center;
            margin-bottom: 20px;
        }

        .prev-next-button {
            background-color: #4CAF50;
            color: #fff;
            border: none;
            padding: 8px 16px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 16px;
            margin-left: 10px;
        }

        /* Show total pages and current page number */
        #showingText {
            color: #555;
            font-weight: bold;
            /* margin-right: 10px; */
            margin-left: 10px;
            margin-top: 10px;
            
        }
    </style>
</head>
<body>
<!-- partial:index.partial.html -->
<div class="wrapper">
    <div id="content">
        <h1><b>Hello </b><span style="color: rgb(235, 89, 89);"><b>{{name}}</b></span> &#128075;</h1>

        <div class="container-fluid">
            <div class="main-content">
                <div class="main-header">
                    <h2>üîì "Unlock Your Desires: <span style="color: rgb(21, 221, 228);"><b>Let Us Know What You Wish to Explore Today!</b></span>" </h2>
                </div>
                <div class="card-group">
                    <div class="card">
                        <!-- Add target="_blank" to open in a new tab -->
                        <a href="http://127.0.0.1:5000/textsentiment" target="_blank">
                            <button class="analyse-button text-button">üìù Unleash the Emotion Power of Text üìù</button>
                        </a>
                    </div>
                    <div class="card">
                        <!-- Add target="_blank" to open in a new tab -->
                        <a href="http://127.0.0.1:5000/filesentiment" target="_blank">
                            <button class="analyse-button file-button">üìÇ Explore Emotions through Files üìÇ</button>
                        </a>
                    </div>
                </div>
                <div id="recent-trends">
                    <h2>üóìÔ∏è "Your Journey with Us: <span style="color: rgb(211, 80, 223);"><b>A Timeline of Your Website Engagements !</b></span>"</h2>
                </div>
                <div class="card-group">
                    <div class="card">
                        <h3>üìù</h3>
                        <h3><b>Text Analysed</b></h3>
                        <h3 id="textCount">Loading...</h3>
                    </div>
                    <div class="card">
                        <h3>üìÇ</h3>
                        <h3><b>File Analysed</b></h3>
                        <h3 id="fileCount">Loading...</h3>
                    </div>
                </div>
                <!-- <h2>üìã "Analytical Insights: <span style="color: rgb(78, 173, 242);"><b>Summary of Analysed Files !</b></span>"</h2> -->
                <div id="table-section">
                    <table class="table">
                      <div class="pagination">
                        <button class="prev-next-button" onclick="previousPage()">Previous</button>
                        <span id="showingText"></span>
                        <button class="prev-next-button" onclick="nextPage()">Next</button>
                      </div>
                        <thead>
                        <tr>
                            <th>FILE NAME</th>
                            <th>FILE TYPE</th>
                            <th>ANALYSED ON</th>
                            <th>OVERALL SENTIMENT</th>
                        </tr>
                        </thead>
                        <tbody id="tableBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <a href="/homepage" class="logout-button"><b>Logout</b></a>
    <!-- partial -->
    <script src='https://cdnjs.cloudflare.com/ajax/libs/highcharts/6.2.0/highcharts.js'></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>

    $(document).ready(function() {
      // Make an AJAX call to the API for card data
      $.ajax({
        url: "http://127.0.0.1:5000/userhistorycard",
        type: "GET",
        dataType: "json",
        success: function(data) {
          // Update the HTML content of the card elements with the received data
          $("#textCount").text(data.Text);
          $("#fileCount").text(data.File);
        },
        error: function(error) {
          console.error("Error fetching card data from API:", error);
        }
      });
    });
        let currentPage = 1;
        const rowsPerPage = 10;
        const tableData = []; // Store the data fetched from the API

        $(document).ready(function () {
            // Make an AJAX call to the API for table data
            $.ajax({
                url: "http://127.0.0.1:5000/userhistorytable",
                type: "GET",
                dataType: "json",
                success: function (data) {
                    tableData.push(...data.data);
                    renderTable();
                },
                error: function (error) {
                    console.error("Error fetching table data from API:", error);
                }
            });
        });

        function renderTable() {
            const startIndex = (currentPage - 1) * rowsPerPage;
            const endIndex = startIndex + rowsPerPage;
            const tableBody = $("#tableBody");
            tableBody.empty();

            for (let i = startIndex; i < endIndex; i++) {
                if (tableData[i]) {
                    const fileData = tableData[i];
                    const row = $("<tr></tr>");

                    fileData.forEach(function (item, index) {
                        if (index === fileData.length - 1) {
                            let colorClass = ""; // Default color class is empty (white background)
                            let sentimentText = ""; // Default sentiment text is empty

                            if (item === "Positive") {
                                colorClass = "positive-bg";
                                sentimentText = "Positive";
                            } else if (item === "Negative") {
                                colorClass = "negative-bg";
                                sentimentText = "Negative";
                            } else if (item === "Neutral") {
                                colorClass = "neutral-bg";
                                sentimentText = "Neutral";
                            }

                            // Append the table cell with the box and text
                            row.append('<td><div class="sentiment-box ' + colorClass + '">' + sentimentText + '</div></td>');
                        } else {
                            // For other columns, just append the data without any changes
                            row.append("<td>" + item + "</td>");
                        }
                    });

                    tableBody.append(row);
                }
            }

            // Update the current page number
            $("#currentPage").text(currentPage);
            // Show the "Showing X of Y" message
            const totalPages = Math.ceil(tableData.length / rowsPerPage);
            $("#showingText").text(`Showing ${currentPage} of ${totalPages}`);
        }

        function nextPage() {
            const totalPages = Math.ceil(tableData.length / rowsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                renderTable();
            }
        }

        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                renderTable();
            }
        }
    </script>
</body>
</html>
